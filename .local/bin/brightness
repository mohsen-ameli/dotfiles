#!/bin/bash
##########################
## Change the brightness of the screen
##########################

iDIR="$HOME/.config/icons"
segment="10%" # How much to increase or decrease the brightness by

print_usage() {
	echo -e """Usage: $0 [arguments]
	
arguments:
	--live: \t get the backlight live
	--get: \t get current backlight 
	--get-text: \t get current backlight without the %
	--dec: \t to decrease backlight
	--inc: \t to increase backlight"""
}

live() {
	get_brightness_text
	inotifywait -e modify -m -q /sys/class/backlight/amdgpu_bl0/brightness | while read -r line; do
		get_brightness_text
	done
}

get_brightness_text() {
	printf "%.0f\n" $(echo "$(brightnessctl get) / $(brightnessctl max) * 100" | bc -l)
}

get_brightness() {
	echo "$(get_brightness_text)%"
}

# Get icons
get_icon() {
	icon="brightness"
	current=$(get_brightness | sed 's/%//')
	# if   [ "$current" -le "20" ]; then
	# 	icon="$iDIR/brightness-20.png"
	# elif [ "$current" -le "40" ]; then
	# 	icon="$iDIR/brightness-40.png"
	# elif [ "$current" -le "60" ]; then
	# 	icon="$iDIR/brightness-60.png"
	# elif [ "$current" -le "80" ]; then
	# 	icon="$iDIR/brightness-80.png"
	# else
	# 	icon="$iDIR/brightness-100.png"
	# fi
}

inc_backlight() {
    brightnessctl set "+$segment"
    get_icon
    notify_user
}

dec_backlight() {
    brightnessctl set "$segment-"
    get_icon
    notify_user
}

# Notify
notify_user() {
	notify-send -h string:x-canonical-private-synchronous:sys-notify -h int:value:$current -u low -i $icon "Brightness: $current%"
}

# Execute accordingly
if [[ $1 == "--live" ]]; then
	live
elif [[ $1 == "--get" ]]; then
	get_brightness
elif [[ $1 == "--get-text" ]]; then
	get_brightness_text
elif [[ $1 == "--inc" ]]; then
	inc_backlight
elif [[ $1 == "--dec" ]]; then
	dec_backlight
else
	print_usage
fi
